
# **DC 接口文档**

DC各模块的接口说明。

---

## **文件操作模块 (`file`)**

### 方法

- **getSeekableFileStream(ipfsPath: string, decryptKey: string): Promise<SeekableFileStream>**  
  获取可寻址文件流。

- **clearFileCache(pathname?: string): void**  
  清理文件缓存。

- **getFile(cid: string, decryptKey: string): Promise<Uint8Array | undefined>**  
  获取文件内容。

- **createFileStream(cid: string, decryptKey: string): Promise<ReadableStream<Uint8Array> | null>**  
  创建文件流。

- **addFile(file: File, enkey: string, onUpdateTransmitSize: (status: number, size: number) => void): Promise<any>**  
  添加文件。

---

## **认证操作模块 (`auth`)**

### 方法

- **accountLogin(nftAccount: string, password: string, safecode: string): Promise<boolean>**  
  账户登录。

- **getUserInfoWithNft(nftAccount: string): Promise<any>**  
  获取用户信息。

- **ifEnoughUserSpace(needSize?: number): Promise<any>**  
  检查用户空间是否足够。

- **refreshUserInfo(): Promise<any>**  
  刷新用户信息。

---

## **评论操作模块 (`comment`)**

### 方法

- **addUserOffChainSpace(): Promise<any>**  
  添加用户链下空间。

- **addThemeObj(theme: string, openFlag: number, commentSpace?: number): Promise<any>**  
  为指定对象开通评论功能。

- **addThemeSpace(theme: string, addSpace: number): Promise<any>**  
  为开通评论的对象增加评论空间。

- **publishCommentToTheme(theme: string, themeAuthor: string, commentType: number, comment: string, refercommentkey?: string, openFlag?: number): Promise<any>**  
  发布评论到主题。

- **deleteSelfComment(theme: string, themeAuthor: string, commentKey: string): Promise<any>**  
  删除评论。

- **getThemeObj(themeAuthor: string, startHeight?: number, direction?: number, offset?: number, limit?: number, seekKey?: string): Promise<any>**  
  获取评论对象列表。

- **getThemeComments(theme: string, themeAuthor: string, startHeight?: number, direction?: number, offset?: number, limit?: number, seekKey?: string): Promise<any>**  
  获取主题评论列表。

- **getUserComments(userPubkey: string, startHeight?: number, direction?: number, offset?: number, limit?: number, seekKey?: string): Promise<any>**  
  获取用户评论列表。

---

## **数据库操作模块 (`db`)**

### 方法

- **newDB(name: string, b32Rk: string, b32Sk: string, jsonCollections: any[]): Promise<string>**  
  创建新数据库。

- **syncDbFromDC(threadid: string, dbname: string, dbAddr: string, b32Rk: string, b32Sk: string, block: boolean, collectionInfos: any[]): Promise<void>**  
  从 DC 同步数据库。

- **createQuery(collectionName: string, threadId: string): Promise<any>**  
  创建数据库查询。

- **createTransaction(threadId: string): Promise<any>**  
  创建数据库事务。

---

## **消息操作模块 (`message`)**

### 方法

- **sendMsgToUserBox(receiver: string, msg: string): Promise<any>**  
  发送消息到用户消息盒子。

- **getMsgFromUserBox(limit?: number): Promise<any>**  
  从用户消息盒子获取消息。

---

## **键值存储模块 (`keyValue`)**

### 方法

- **vaCreateStoreTheme(themeAuthor: string, theme: string, space: number, type: number): Promise<any>**  
  创建存储主题。

- **getCacheValue(key: string): Promise<string | null>**  
  获取缓存值。

- **setCacheKey(value: string, expire?: number): Promise<any>**  
  设置缓存值。

---

## **区块链操作模块 (`dcChain`)**

### 方法

- **getBlockHeight(): Promise<number>**  
  获取区块高度。

---

## **客户端操作模块 (`client`)**

### 方法

- **getHostID(): Promise<[{ peerID: string; reqAddr: string } | null, Error | null]>**  
  获取 Host ID。

---

### **使用示例**

```typescript
import { DC } from './dc-compat';

async function main() {
  const dc = new DC({
    wssUrl: '区块链路径',
    backWssUrl: '区块链备用路径',
    appInfo: {
      id: 'DCAPP',
      name: 'DCAPP Name',
    },
  });
  await dc.init();

  // 获取用户信息
  const userInfo = await dc.auth.getUserInfoWithNft('nftAccount');

  // 上传文件
  const file = new File(['content'], 'test.txt');
  await dc.file.addFile(file, 'encryptKey', (status, size) => {
    console.log(`上传进度：${status}%, 大小：${size}`);
  });

  // 发送消息
  await dc.message.sendMsgToUserBox('receiver', 'Hello World!');

  // 获取 Host ID
  const hostID = await dc.client.getHostID();
  console.log('Host ID:', hostID);

  // 评论操作
  const themeComments = await dc.comment.getThemeComments('theme', 'themeAuthor');
  console.log('主题评论:', themeComments);

}

main().catch((error) => {
  console.error('发生错误:', error);
});
```
